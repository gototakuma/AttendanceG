<!--contorller-->
<% @user = User.find(params[:id])%>
<% @users = User.all %>
<% @attendance = Attendance.find(params[:id]) %>
<% @instructor = User.where(instructor: true) %>
<%  if params[:ftime].nil?
      @ftime = Date.today.beginning_of_month
    else
      @ftime = Date.parse(params[:ftime])
    end
    @ltime = @ftime.end_of_month
    (@ftime..@ltime).each do |day|
      unless @user.attendances.any?{|attendance| attendance.worked_on == day}
        record = @user.attendances.build(worked_on: day)
        record.save
      end
    end
    @dates = user_attendances_month_date
%> 

<!--views-->

    <div class="modal-dialog modal-lg modal-dialog-center">
      <div class="modal-content">
        <%= form_for(@user, url: update_receive_overtime_path(params: {id: @user.id})) do |f| %>
        <% @users.each do |user| %>
        <div class="modal-header">
          <h1>【<%= user.name %>からの残業申請】</h1>
        </div><!--header-->
        <div class="modal-body">
        <table class="table-bordered table-striped table-condensed">
          <tr>
            <td>日付</td>
            <td>曜日</td>
            <td>終了予定時間</td>
            <td>指定勤務終了時間</td>
            <td>時間外時間</td>
            <td>業務処理内容</td>
            <td>指示者確認㊞</td>
            <td>変更</td>
            <td>勤怠を確認</td>
          </tr>
        <tbody>
          <% attendances = Attendance.where(user_id: user.id) %>
          <% attendances.each do |at| %>
          <%= fields_for"attendances[]", at do |af| %>
          <% if at.over_time.present? %>
          <tr>
            <td><%= at.worked_on.to_s(:date) %></td>
            <td>
              <% week_name = %w[日 月 火 水 木 金 土] %>
              <% str = week_name[at.worked_on.wday] %>
              <% if at.worked_on.wday == 0 %>
                <font color="red"><%=week_name[at.worked_on.wday]%></font>
              <% elsif at.worked_on.wday == 6 %>
                <font color="blue"><%=week_name[at.worked_on.wday]%></font>
              <%else%>
                <%= str%>
              <%end%>
            </td>
            <td><%= at.over_time.to_s(:hourmin)%></td>
            <td><%= format_basic_time(@user.finish_time) %></td>
            <td><%= overtimes_sub(at.over_time, @user.finish_time) %></td>
            <td><%= at.overtime_note %></td>
            <td><%= af.select :approval, Attendance.approvals.keys.to_a ,{} , class: "form-control"%></td>
            <td><%=  %></td>
            <td><%= f.submit "確認", class: "btn btn-primary" %></td>
          </tr>
         <%end%><!--if-->
         <%end%>
         <%end%><!--atttendance.each-->
        </tbody>
        </table>
         </div><!--modal-body-->
        <%end%><!--@users.each-->
        <div class="modal-footer">
          <div class="overtime_receive_bottun">
            <%= f.submit "変更を送信する", class: "btn btn-primary" %>
          </div><!--bottun-->
        </div><!--modal-footer-->
        <%end%><!--form_for-->
     </div><!--content-->
  </div><!--dialog-->


